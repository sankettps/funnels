<% unless @shop.is_products_cloned %>
  <div class="sync_product">
    <img src="/assets/loader.gif">
    We are synchronising products Please wait...
  </div>
<% end %>

  <div class="row">
    <div class="col-lg-12">
      <div class="panel panel-default">
        <div class="panel-heading clearfix">
          <h4>Funnel List</h4>
          <a href="<%= new_funnel_path %>" class="add_new"><button class="btn btn-default add_new">Add New</button> </a>
        </div>
        <!-- /.panel-heading -->
        <div class="panel-body"> 
          <table width="100%" class="table table-striped table-bordered table-hover funnels-list" id="dataTables-example">
            <thead>
              <tr>
                <th>Funnel Name</th>
                <th>Upsell Popup Title</th>
                <th>Downsell Popup Title</th>
                <th>Actions</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% @funnels.each do |funnel| %>
                <tr>
                  <td><%= funnel.name %></td>
                  <td><%= funnel.up_sell_title %></td>
                  <td><%= funnel.down_sell_title %></td>
                  <td class="center">
                    <%= link_to '<i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>'.html_safe,edit_funnel_path(funnel.id) %>
                    <%#= link_to '<i class="fa fa-trash-o" aria-hidden="true"></i>'.html_safe,"#" %>
                    <a data-confirm="Are you sure you want to delete?" rel="nofollow" data-method="delete" href="/funnels/<%= funnel.id %>"><i class="glyphicon glyphicon-trash" aria-hidden="true"></i></a>
                  </td>
                  <td class="center">
                    <input type="checkbox" id="fid<%= funnel.id %>" name="set-name" class="switch-input funnel_status" data-id="<%= funnel.id %>" <%= funnel.is_active ? 'checked' : '' %>>
                  <label for="fid<%= funnel.id %>" class="switch-label"></label>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
            <!-- /.table-responsive -->
        </div>
        <!-- /.panel-body -->
      </div>
      <!-- /.panel -->
    </div>
      <!-- /.col-lg-12 -->
  </div>
  <div class="cover" id="cover"></div>
<script type="text/javascript">
  $(document).ready(function() {
    $('#dataTables-example').DataTable({
        responsive: true
    });
    <% unless @shop.is_products_cloned %>
      var set_loader = setInterval(function(){
        $.ajax({
          type:'GET',
          url: '/dashboard/product_sync_status',
          success:function(data){
            console.log("inside success-->",data);
            if(data == "synced"){
              console.log("inside if");
              $(".sync_product").html('');
              clearInterval(set_loader);
            }
          }
        })
      },10000);
    <% end %>

    $(document).on('change', '.funnel_status', function(event) {
      console.log("tesstttt",$(this).data('id'));
      $("#cover").show();
      $.ajax({
        url: '/funnels/change_status',
        dataType: 'script',
        data: {id: $(this).data('id')},
      })
      .done(function() {
        console.log("success");
      })
      .fail(function() {
        console.log("error");
      })
      .always(function() {
        $("#cover").hide();
      });
      
      event.preventDefault();
      /* Act on the event */
    });
    
  });

</script>